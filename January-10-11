import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.metrics import r2_score
from sklearn.linear_model import Ridge, Lasso
from sklearn.preprocessing import StandardScaler, MinMaxScaler, OneHotEncoder, LabelEncoder
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LogisticRegression
from sklearn.naive_bayes import GaussianNB, MultinomialNB, BernoulliNB
from sklearn.neighbors import KNeighborsClassifier
from sklearn.svm import SVC
from sklearn.tree import DecisionTreeClassifier
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import (accuracy_score, confusion_matrix, classification_report,roc_auc_score, roc_curve, auc)
import warnings
warnings.filterwarnings('ignore')
warnings.filterwarnings('ignore')

#df = pd.read_csv('FloridaBikeRentals.csv')  # Example of reading a dataset
df = pd.read_csv('FloridaBikeRentals.csv', encoding='latin1')
df.head()
print(df.info())
print(df.describe())
df.isnull().sum()

df['Date'] = pd.to_datetime(df['Date'], format='%d/%m/%Y')
df['Month'] = df['Date'].dt.month
print(df['Month'])
df['Day'] = df['Date'].dt.day
print(df['Day'])
df['Year'] = df['Date'].dt.year
print(df['Year'])
df['Weekday'] = df['Date'].dt.weekday
print(df['Weekday'])
df['IsWeekend'] = df['Weekday'].apply(lambda x: 1 if x >= 5 else 0)
print(df['IsWeekend'])

print(df.sample(5))

#Check correlation using heatmap
# df.corr(numeric_only=True)
# plt.figure(figsize=(14,8))
# sns.heatmap(df.corr(numeric_only=True), annot=True, cmap='coolwarm')
# plt.title('Correlation Heatmap')
# #plt.show()

# #Distribution for rented Bike count
# plt.figure(figsize=(10,6))
# sns.histplot(df['Rented Bike Count'], bins=30, kde=True)
# plt.title('Distribution of Bike Rentals')
# plt.xlabel('Bike Count')
# plt.ylabel('Frequency')
# plt.show()


# num_cols = df.select_dtypes(include=['int64', 'float64']).columns
# for col in num_cols:
#     plt.figure(figsize=(10,6))
#     sns.boxplot(x=df[col])
#     plt.title(f'Boxplot of {col}')
#     plt.tight_layout()
#     plt.show()


#     num_cols = df.select_dtypes(include=['int64', 'float64']).columns
# for col in num_cols:
#     plt.figure(figsize=(10,6))
#     sns.histplot(x=df[col])
#     plt.title(f'Histogram of {col}')
#     plt.tight_layout()
#     plt.show()

#     fig, axes = plt.subplots(nrows=3, ncols=3, figsize=(15, 15))
#     axes = axes.flatten()
#     num_cols = df.select_dtypes(include=['int64', 'float64']).columns
# for i, col in enumerate(num_cols):
#     sns.boxplot(x=df[col], ax=axes[i])


# cat_cols = df.select_dtypes(include='object').columns
# rows = 3
# plt.figure(figsize=(15, 5 * rows))
# for i, feature in enumerate(cat_cols):
#     plt.subplot(rows, 3, i + 1)
#     sns.boxplot(x=df[feature])
#     plt.title(f'Boxplot of {feature}')
#     plt.xlabel(feature)
#     plt.ylabel('Rented Bike Count')
# plt.tight_layout()
# plt.show()


# cat_cols = df.select_dtypes(include='object').columns

# for col in cat_cols:
#     sns.boxplot(x=df[col], y=df['Rented Bike Count'])
#     plt.title(f'Boxplot of {col} vs Rented Bike Count')
#     plt.xlabel(col)
#     plt.ylabel('Rented Bike Count')
#     plt.show()

# features = ['Hour', 'Holiday', 'Rainfall(mm)', 'Snowfall (cm)', 'IsWeekend']
# for feature in features:
#     plt.figure(figsize=(8, 6))
#     sns.catplot(x=feature, y='Rented Bike Count', data=df, kind='bar')
#     plt.title(f"Rented Bike Count vs {feature}")
#     plt.show()

# Train model Regression
X = df[['Hour', 'Rainfall(mm)', 'Snowfall (cm)', 'IsWeekend']]
y = df['Rented Bike Count'] 
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train) 
y_pred = model.predict(X_test)
accuracy = accuracy_score(y_test, y_pred)   
print(f'Accuracy: {accuracy:.2f}')
# Scale features and train Ridge regression
scaler = StandardScaler()
x_train_scaled = scaler.fit_transform(X_train)
x_test_scaled = scaler.transform(X_test)

rd = Ridge()
rd.fit(x_train_scaled, y_train)
y_pred_rd = rd.predict(x_test_scaled)
rd_r2 = r2_score(y_test, y_pred_rd)
print(f'Ridge R2 score: {rd_r2:.4f}')
rd_r2


lasso = Lasso()
lasso.fit(x_train_scaled,y_train)
lasso_pred = lasso.predict(x_test_scaled)
lasso_r2 = r2_score(y_test,lasso_pred)
print(f'Lasso R2 score: {lasso_r2:.4f}')
lasso_r2




# Capstone Project2
